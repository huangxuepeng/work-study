# 项目概述
## 项目名称
软件商店(fhmc-software-store)
## 开发意图
对接软件平台, 补全平台对客户端软件上的功能缺失, 对接服务安装部署软件, 功能上实现对服务安装部署软件的兼容及延伸扩展，同时实现与服务安装部署软件的数据互通。
## 总体设计
![总体图](../%E7%AC%AC%E4%B8%89%E5%91%A8%E5%B7%A5%E4%BD%9C/%E6%80%BB%E4%BD%93%E8%AE%BE%E8%AE%A1%E5%9B%BE.jpg)
### 软件段创建
软件段通过软件商店服务上传，通过后缀来使用不同的解压方式得到压缩包内的数据, 通过前缀查询数据库是否存在判断是否存在, 这一步模块不将数据存入etcd, 只是返回uid, 当创建调用create的时候存入etcd.  
写入etcd创建记录, 之后调用rpc接口查询数据并且为返回存储数据.
![软件段创建](../work/%E7%AC%AC%E4%B8%89%E5%91%A8%E5%B7%A5%E4%BD%9C/%E8%BD%AF%E4%BB%B6%E6%AE%B5%E5%88%9B%E5%BB%BA.png)
### 获取软件段列表
接收用户的对软件段的显示需求, 通过得到的参数从etcd中得到数据, 并且返回前端.
![获取软件段列表](../work/%E7%AC%AC%E4%B8%89%E5%91%A8%E5%B7%A5%E4%BD%9C/%E8%8E%B7%E5%8F%96%E8%BD%AF%E4%BB%B6%E6%AE%B5%E5%88%97%E8%A1%A8.png)
### 获取某个软件段的所有版本
首先根据前端传来数据对指定的软件版本获取所有的版本, 通过前端传递数据查询etcd得到软件段是否被删除的状态, 如果该软件段已经被删除, 那就不存在所有的版本; 未被删除调用rpc 接口得到软件段前缀并且去etcd中查询软件段的所有版本, 并且返回数据.
![获取某个软件段的所有版本](../%E7%AC%AC%E4%B8%89%E5%91%A8%E5%B7%A5%E4%BD%9C/%E8%8E%B7%E5%8F%96%E8%BD%AF%E4%BB%B6%E6%AE%B5%E7%9A%84%E6%89%80%E6%9C%89%E7%89%88%E6%9C%AC.png)
### 更新段绑定的席位列表信息
通过前端传递数据查询etcd得到软件段的绑定的列表信息, 根据segid查询软件段的段绑定席位的状态, 调用rpc接口获取到前缀并且调用etcd接口去更新版本信息并且对更新时的所有席位进行加锁, 并且将席位列表更新, 将新的软件段详情信息传递给前端;
![更新段绑定的席位列表信息](../%E7%AC%AC%E4%B8%89%E5%91%A8%E5%B7%A5%E4%BD%9C/%E6%9B%B4%E6%96%B0%E6%AE%B5%E7%BB%91%E5%AE%9A%E7%9A%84%E5%B8%AD%E4%BD%8D%E5%88%97%E8%A1%A8%E4%BF%A1%E6%81%AF.png)
### 段卸载
首先进行卸载段检测, 查询它是否被依赖, 通过调用rpc接口获取它的席位信息, 而后调用server的接口获取每个席位的节点信息, 最后返回被依赖信息的结果信息; etcd中查询到要卸载的软件段详情, 并且查找不存在的节点信息, 卸载时传入所所有已安装的节点, 而后将席位安装记录更新, 完成卸载;
![段卸载](../%E7%AC%AC%E4%B8%89%E5%91%A8%E5%B7%A5%E4%BD%9C/%E6%AE%B5%E5%8D%B8%E8%BD%BD.png)